---
import "../styles/global.css";
import type { Theme, FontPreset } from "../types/theme";
import CookieConsent from '../components/CookieConsent.astro';

interface Props {
  title: string;
  description: string;
  theme?: Theme;
  font?: FontPreset;
}

const { theme, title, description, font = "modern" }: Props = Astro.props;

// Mapa: preset -> URL de Google Fonts (solo la necesaria)
const FONT_LINKS: Record<FontPreset, string> = {
  modern:
    "https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap",
  elegant:
    "https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Playfair+Display:wght@700&display=swap",
  grotesk:
    "https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap",
};
---

<!doctype html>
<html lang="pt-BR" data-theme={theme} data-font={font}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <!-- Carga condicional de la fuente elegida -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link href={FONT_LINKS[font]} rel="stylesheet" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
    <meta name="description" content={description} />

    <!-- Open Graph -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="pt_BR" />
    <meta property="og:image" content={Astro.url.origin + "/img/profile.png"} />
    <meta property="og:image:alt" content={title} />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={Astro.url.origin + "/img/profile.png"} />
    <meta name="twitter:image:alt" content={title} />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <style>
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
      }
    </style>
  </head>
  <body>
    <div
      id="vanta-bg"
      class="min-h-screen relative overflow-hidden"
    >
      {/* Content */}
      <slot />
    </div>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script>
      import * as THREE from 'three';
      import CLOUDS from 'vanta/dist/vanta.clouds2.min.js';
    
      const vantaEffect = CLOUDS({
        el: '#vanta-bg',
        THREE: THREE,
        mouseControls: true,
        touchControls: true,
        gyroControls: false,
        minHeight: 200.00,
        minWidth: 200.00,
        speed: 0.6,
        backgroundColor: 0x411d0b,
        skyColor: 0x9212d
      });

      const setVantaHeight = () => {
        if (vantaEffect) {
          vantaEffect.resize();
        }
      };

      window.addEventListener('resize', setVantaHeight);
      setVantaHeight();
    </script>
    <CookieConsent />
  </body>
</html>
